# Dr.aiVOSS æµ‹è¯•ç­–ç•¥æŒ‡å—

| ç‰ˆæœ¬å· | åˆ›å»ºæ—¶é—´ | æ›´æ–°æ—¶é—´ | æ–‡æ¡£ä¸»é¢˜ | åˆ›å»ºäºº |
|--------|----------|----------|----------|--------|
| v1.2   | 2026-02-03 | 2026-02-05 | Dr.aiVOSS æµ‹è¯•ç­–ç•¥æŒ‡å— | Randy Luo |

---

**ç‰ˆæœ¬å˜æ›´è®°å½•ï¼š**
| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´å†…å®¹ |
|------|------|----------|
| v1.2 | 2026-02-05 | ğŸ”´ ç§»é™¤ VAVE ç›¸å…³æµ‹è¯•ç”¨ä¾‹ï¼ˆåŒè½¨è®¡ç®—æµ‹è¯•ï¼‰ |
| v1.1 | 2026-02-03 | åˆå§‹ç‰ˆæœ¬ |

---

## 1. æµ‹è¯•é‡‘å­—å¡”æ¶æ„

```
                    /\
                   /  \
                  / E2E \
                 /______\
                /        \
               /é›†æˆæµ‹è¯•  \
              /__________\
             /            \
            /  å•å…ƒæµ‹è¯•    \
           /________________\
```

| å±‚çº§ | å æ¯” | è¦†ç›–èŒƒå›´ | å·¥å…·/æ¡†æ¶ |
|------|------|----------|-----------|
| **å•å…ƒæµ‹è¯•** | 70% | ç‹¬ç«‹å‡½æ•°ã€ç±»ã€ç»„ä»¶ | pytest (Python), Vitest (TS) |
| **é›†æˆæµ‹è¯•** | 20% | API æ¥å£ã€æ•°æ®åº“äº¤äº’ | pytest + fixtures |
| **E2E æµ‹è¯•** | 10% | å®Œæ•´ä¸šåŠ¡æµç¨‹ | Playwright |

---

## 2. æ ‡å‡†æˆæœ¬è®¡ç®—æµ‹è¯•è¦†ç›–è¦æ±‚

### 2.1 æ ¸å¿ƒè®¡ç®—å…¬å¼æµ‹è¯•

**å¿…é¡»è¦†ç›–çš„åœºæ™¯ï¼š**

| åœºæ™¯ | æ ‡å‡†æˆæœ¬ | é¢„æœŸç»“æœ |
|------|----------|----------|
| æ­£å¸¸è®¡ç®— | > 0 | æ­£ç¡®è®¡ç®—æˆæœ¬ |
| é›¶æˆæœ¬ | 0 | è¿”å›é›¶å€¼ |
| æ•°å€¼ç²¾åº¦ | å°æ•°ä½ | ä¿ç•™2ä½å°æ•° |
| è´Ÿå€¼å¤„ç† | < 0 | ä¸å…è®¸è´Ÿæˆæœ¬ |

**æµ‹è¯•ç”¨ä¾‹ç¤ºä¾‹ï¼š**

```python
# tests/core/test_price_pair.py
import pytest
from decimal import Decimal

def test_price_pair_calculations():
    """æµ‹è¯•æ ‡å‡†ä»·æ ¼è®¡ç®—"""
    from app.models import PricePair

    # æ­£å¸¸è®¡ç®—
    pair = PricePair(std=Decimal("100.00"))
    assert pair.std == Decimal("100.00")

def test_negative_cost_rejected():
    """æµ‹è¯•è´Ÿæˆæœ¬è¢«æ‹’ç»"""
    with pytest.raises(ValidationError):
        PricePair(std=Decimal("-10.00"))
```

### 2.2 è¾¹ç•Œå€¼æµ‹è¯•

| å‚æ•° | æœ€å°å€¼ | æœ€å¤§å€¼ | è¾¹ç•Œè¡Œä¸º |
|------|--------|--------|----------|
| ç‰©æ–™æ•°é‡ | 0.001 | 999999.999 | è¶…é™æŠ›å¼‚å¸¸ |
| å·¥æ—¶(ç§’) | 1 | 86400 (24h) | è¶…é™è­¦å‘Š |
| MHR è´¹ç‡ | 0.01 | 9999.99 | è¶…é™æŠ›å¼‚å¸¸ |
| èŠ‚çœç‡ | 0% | 100% | >100% æ ‡è®°å¼‚å¸¸ |

---

## 3. BOM è§£ææµ‹è¯•æ•°æ®é›†

### 3.1 æ ‡å‡†æµ‹è¯•ç”¨ä¾‹

**æ–‡ä»¶:** `tests/fixtures/bom_samples/`

| ç”¨ä¾‹ | æ–‡ä»¶å | åœºæ™¯æè¿° | é¢„æœŸç»“æœ |
|------|--------|----------|----------|
| å®Œç¾åŒ¹é… | `perfect_match.xlsx` | æ‰€æœ‰ç‰©æ–™å·éƒ½åœ¨åº“ä¸­ | ğŸŸ¢ 100% |
| éƒ¨åˆ†åŒ¹é… | `partial_match.xlsx` | 50% ç‰©æ–™å·åŒ¹é… | ğŸŸ¢ 50%, ğŸŸ¡ 50% |
| æ— åŒ¹é… | `no_match.xlsx` | æ‰€æœ‰ç‰©æ–™å·ä¸åœ¨åº“ä¸­ | ğŸ”´ 100% |
| å« Comments | `with_comments.xlsx` | å¤‡æ³¨åˆ—å«å·¥è‰ºå‚æ•° | æ­£ç¡®æå–ç‰¹å¾ |
| ç©ºç™½è¡Œ | `with_empty_rows.xlsx` | åŒ…å«ç©ºç™½è¡Œ | è‡ªåŠ¨è·³è¿‡ |
| ç‰¹æ®Šå­—ç¬¦ | `special_chars.xlsx` | ç‰©æ–™åå«ç‰¹æ®Šç¬¦å· | æ­£å¸¸å¤„ç† |

### 3.2 Comments ç‰¹å¾æå–æµ‹è¯•

| è¾“å…¥ Comments | é¢„æœŸæå–ç‰¹å¾ | ç½®ä¿¡åº¦ |
|---------------|--------------|--------|
| "æŠ˜å¼¯ï¼š32æ¬¡ï¼Œç„Šæ¥ï¼š4ç‚¹" | `{"bending": 32, "welding": 4}` | ğŸŸ¢ é«˜ |
| "éœ€è¦çƒ­å¤„ç†" | `{"heat_treatment": true}` | ğŸŸ¡ ä¸­ |
| "ï¼ˆç©ºç™½ï¼‰" | `{}` | ğŸ”´ æ—  |

---

## 4. API æ¥å£æµ‹è¯•è§„èŒƒ

### 4.1 å“åº”ç»“æ„éªŒè¯

**æ¯ä¸ª API å¿…é¡»éªŒè¯ï¼š**

```python
def test_api_response_structure():
    """æµ‹è¯• API å“åº”ç»“æ„"""
    response = client.get("/api/v1/projects/PRJ-001")

    assert response.status_code == 200
    data = response.json()

    # å¿…éœ€å­—æ®µ
    assert "id" in data
    assert "project_name" in data
    assert "status" in data

    # åŒè½¨ä»·æ ¼å­—æ®µ
    if "quote" in data:
        assert "std_cost" in data["quote"]
        assert "vave_cost" in data["quote"]
        assert "savings" in data["quote"]
```

### 4.2 é”™è¯¯ç æµ‹è¯•

| é”™è¯¯ç  | åœºæ™¯ | é¢„æœŸå“åº” |
|--------|------|----------|
| 400 | ç¼ºå°‘å¿…éœ€å‚æ•° | `{"error": "missing_field", "field": "annual_volume"}` |
| 404 | é¡¹ç›®ä¸å­˜åœ¨ | `{"error": "project_not_found", "id": "PRJ-999"}` |
| 422 | æ•°æ®éªŒè¯å¤±è´¥ | `{"error": "validation_error", "details": [...]}` |
| 500 | æœåŠ¡å™¨é”™è¯¯ | `{"error": "internal_error", "message": "..."}` |

---

## 5. æ€§èƒ½æµ‹è¯•åŸºå‡†

### 5.1 BOM è§£ææ€§èƒ½

| åœºæ™¯ | æ•°æ®é‡ | å“åº”æ—¶é—´ç›®æ ‡ | å†…å­˜é™åˆ¶ |
|------|--------|--------------|----------|
| å°å‹ | 100 è¡Œ | < 1 ç§’ | < 50MB |
| ä¸­å‹ | 1,000 è¡Œ | < 5 ç§’ | < 200MB |
| å¤§å‹ | 10,000 è¡Œ | < 30 ç§’ | < 1GB |

### 5.2 è®¡ç®—æ€§èƒ½

| æ“ä½œ | ç›®æ ‡ QPS | P95 å»¶è¿Ÿ |
|------|----------|----------|
| æˆæœ¬è®¡ç®— | 100 | < 500ms |
| ç‰©æ–™æŸ¥è¯¢ | 500 | < 100ms |
| æŠ¥ä»·ç”Ÿæˆ | 50 | < 2s |

---

## 6. CI/CD é›†æˆç­–ç•¥

### 6.1 GitHub Actions å·¥ä½œæµ

```yaml
# .github/workflows/test.yml
name: Test Suite

on: [push, pull_request]

jobs:
  backend-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          pip install pytest pytest-cov
      - name: Run tests
        run: |
          pytest --cov=app --cov-report=xml
      - name: Coverage check
        run: |
          coverage report --fail-under=80

  frontend-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Set up Node
        uses: actions/setup-node@v3
        with:
          node-version: '20'
      - name: Install dependencies
        run: cd frontend && npm install
      - name: Run tests
        run: cd frontend && npm test
```

### 6.2 ä»£ç è¦†ç›–ç‡è¦æ±‚

| æ¨¡å— | æœ€ä½è¦†ç›–ç‡ | æ¨èè¦†ç›–ç‡ |
|------|-----------|-----------|
| æ ¸å¿ƒè®¡ç®—é€»è¾‘ | 90% | 95% |
| API è·¯ç”± | 80% | 90% |
| æ•°æ®æ¨¡å‹ | 85% | 90% |
| å‰ç«¯ç»„ä»¶ | 70% | 80% |

---

## 7. æµ‹è¯•æ•°æ®ç®¡ç†

### 7.1 æ•°æ®éš”ç¦»ç­–ç•¥

| ç¯å¢ƒ | æ•°æ®æ¥æº | åˆ·æ–°ç­–ç•¥ |
|------|----------|----------|
| å•å…ƒæµ‹è¯• | Mock/Fixture | æ— éœ€çœŸå®æ•°æ® |
| é›†æˆæµ‹è¯• | æµ‹è¯•æ•°æ®åº“ | æ¯æ¬¡è¿è¡Œé‡ç½® |
| E2E æµ‹è¯• | ä¸“ç”¨æµ‹è¯•ç¯å¢ƒ | æ¯æ—¥é‡ç½® |

### 7.2 æ•æ„Ÿæ•°æ®å¤„ç†

- ç¦æ­¢åœ¨æµ‹è¯•ä»£ç ä¸­ç¡¬ç¼–ç çœŸå®å®¢æˆ·æ•°æ®
- ä½¿ç”¨è„±æ•åçš„æ•°æ®ä½œä¸ºæµ‹è¯•ç”¨ä¾‹
- æµ‹è¯•æ•°æ®åº“å¯†ç ä½¿ç”¨ç¯å¢ƒå˜é‡

---

## 8. è¿è¡Œæµ‹è¯•å‘½ä»¤

```bash
# åç«¯æµ‹è¯•
cd backend
pytest                          # è¿è¡Œå…¨éƒ¨æµ‹è¯•
pytest -v                        # è¯¦ç»†è¾“å‡º
pytest --cov=app                 # ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest tests/core/test_price_pair.py  # è¿è¡Œç‰¹å®šæ–‡ä»¶

# å‰ç«¯æµ‹è¯•
cd frontend
npm test                         # è¿è¡Œå…¨éƒ¨æµ‹è¯•
npm run test:ui                  # UI æ¨¡å¼
npm run test:coverage            # ç”Ÿæˆè¦†ç›–ç‡

# E2E æµ‹è¯•
npm run test:e2e                 # è¿è¡Œ E2E æµ‹è¯•
```

---

## 9. æµ‹è¯•æ£€æŸ¥æ¸…å•

å¼€å‘æ–°åŠŸèƒ½æ—¶ï¼Œå¿…é¡»å®Œæˆï¼š

- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%
- [ ] æ ¸å¿ƒè®¡ç®—é€»è¾‘æœ‰è¾¹ç•Œå€¼æµ‹è¯•
- [ ] API æ¥å£æœ‰é”™è¯¯ç æµ‹è¯•
- [ ] åŒè½¨è®¡ç®—ç»“æœå·²éªŒè¯
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡åŸºå‡†
- [ ] ä»£ç å®¡æŸ¥é€šè¿‡
- [ ] æ–‡æ¡£å·²åŒæ­¥æ›´æ–°

---

## 10. ç›¸å…³æ–‡æ¡£

- [docs/API_REFERENCE.md](API_REFERENCE.md) - API å®Œæ•´å‚è€ƒ
- [docs/BUSINESS_CASE_LOGIC.md](BUSINESS_CASE_LOGIC.md) - è®¡ç®—é€»è¾‘
- [CLAUDE.md](../CLAUDE.md) - å¼€å‘åä½œæŒ‡å—

---

**æ–‡æ¡£ç»“æŸ**
